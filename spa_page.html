<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI, 건설 업무의 시간을 되돌려 드립니다!</title>
    <link rel="stylesheet" href="css/common_styles.css">
    <style>
        /* --- 데스크탑 햄버거 버튼 (고정 기능용) --- */
        #desktop-pin-toggle-btn {
            display: none; /* JS로 데스크탑일 때만 보이도록 제어 */
            position: fixed;
            top: 15px;
            left: 10px;
            z-index: 105;
            background-color: var(--primary-color, #3155e2);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            font-size: 16px;
            line-height: 30px;
            text-align: center;
            cursor: pointer;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            transition: left 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        #desktop-pin-toggle-btn.pinned-icon::before { content: "📌"; }
        #desktop-pin-toggle-btn:not(.pinned-icon)::before { content: "☰"; }

        /* 데스크탑 네비게이션 고정 상태 */
        .page-navigation.pinned {
            width: var(--nav-expanded-width) !important;
            opacity: 1 !important;
            overflow: visible !important;
            background-color: var(--nav-bg-expanded) !important;
            box-shadow: 5px 0 15px rgba(0,0,0,0.1) !important;
        }
        .page-navigation.pinned .nav-header,
        .page-navigation.pinned .nav-scroll-wrapper {
            opacity: 1 !important;
        }
        body.desktop-nav-pinned #desktop-pin-toggle-btn {
             left: calc(var(--nav-expanded-width) - 25px); /* 고정 시 버튼 위치 조정 */
        }


        /* --- 모바일 전용 스타일 --- */
        @media (max-width: 768px) {
            .page-navigation { /* 데스크탑 네비게이션은 모바일에서 완전히 숨김 */
                pointer-events: none !important;
                opacity: 0 !important; width: 0 !important; border: none !important;
                padding: 0 !important; margin: 0 !important;  overflow: hidden !important;
                transition: none !important;
            }
            #desktop-pin-toggle-btn { display: none !important; }

            #mobile-hamburger-btn {
                display: block; position: fixed; top: 15px; left: 15px; z-index: 1002;
                background-color: var(--primary-color, #3155e2); color: white; border: none;
                padding: 8px 12px; font-size: 20px; cursor: pointer; border-radius: 5px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            }

            #mobile-sidebar-container {
                position: fixed; top: 0; left: 0; width: 280px; height: 100vh;
                background-color: var(--nav-bg-expanded, #fff); z-index: 1001;
                transform: translateX(-100%); transition: transform 0.3s ease-in-out;
                overflow-y: auto; box-shadow: 2px 0 5px rgba(0,0,0,0.1);
                padding-top: 50px; /* Close button height */
            }
            #mobile-sidebar-container.open { transform: translateX(0); }

            #mobile-sidebar-close-btn {
                position: absolute; top: 15px; right: 15px; font-size: 24px;
                background: none; border: none; color: var(--primary-color, #3155e2);
                cursor: pointer;
            }

            /* 모바일 사이드바 내부의 네비게이션 요소 스타일 */
            #mobile-sidebar-container .nav-header,
            #mobile-sidebar-container .nav-scroll-wrapper {
                opacity: 1 !important; width: 100% !important;
            }
            #mobile-sidebar-container .nav-header { padding-top: 10px; border-bottom: 1px solid var(--border-color, #eaeaea); }
            #mobile-sidebar-container .nav-scroll-wrapper { padding: 15px 0; }
            #mobile-sidebar-container .nav-section-item.current-page a,
            #mobile-sidebar-container .nav-instructor-profile-link-wrapper.current-page a { /* 강사소개 링크 활성화 스타일 */
                background-color: var(--nav-active-bg, #3155e2) !important;
                color: var(--nav-active-text, #fff) !important;
                font-weight: 600; border-radius: 4px;
            }
             /* 강사소개 링크 기본 스타일 for mobile sidebar (nav-section-item a 와 유사하게) */
            #mobile-sidebar-container .nav-instructor-profile-link-wrapper a {
                display: block; text-decoration: none; color: #555; padding: 10px 35px; /* 섹션 아이템과 패딩 맞춤 */
                font-size: 0.9rem; transition: background-color 0.2s ease, color 0.2s ease;
                border-bottom: 1px solid #eee; white-space: normal;
                overflow-wrap: break-word; word-break: keep-all;
            }
            #mobile-sidebar-container .nav-instructor-profile-link-wrapper a:hover {
                background-color: var(--secondary-color); color: var(--primary-color);
            }


            #mobile-overlay {
                display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background-color: rgba(0,0,0,0.5); z-index: 1000;
            }
            #mobile-overlay.active { display: block; }

            .main-content-area {
                padding-top: 60px !important; /* 모바일 햄버거 버튼 높이 고려 */
                padding-bottom: 80px !important; /* 모바일 하단 네비게이션 버튼 높이 고려 */
            }

            #page-navigation-buttons {
                display: flex; position: fixed; bottom: 0; left: 0; width: 100%;
                padding: 10px 0px; background-color: rgba(250, 250, 250, 0.95);
                box-shadow: 0 -2px 8px rgba(0,0,0,0.1); z-index: 999;
                justify-content: space-between; align-items: center;
                backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
            }
            #page-navigation-buttons button {
                padding: 10px 15px; font-size: 0.9em; font-weight: 500;
                background-color: var(--primary-color, #3155e2); color: white; border: none;
                border-radius: 5px; cursor: pointer; transition: background-color 0.2s ease;
                min-width: 70px; text-align: center; flex-shrink: 0; margin: 0 10px;
            }
            #current-section-name-display {
                flex-grow: 1; text-align: center; font-size: 0.85em;
                color: var(--dark-text, #333); padding: 0 5px;
                overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
            }
            #page-navigation-buttons button:hover:not(:disabled) { background-color: #2a49c7; }
            #page-navigation-buttons button:disabled { background-color: #ccc; color: #777; cursor: not-allowed; opacity: 0.7; }
        }

        /* 데스크탑에서는 모바일 UI 요소 숨김 */
        @media (min-width: 769px) {
            #mobile-hamburger-btn,
            #mobile-sidebar-container,
            #mobile-overlay,
            #page-navigation-buttons {
                display: none !important;
            }
            .main-content-area { /* 데스크탑 패딩 원상복구 */
                padding-top: 30px !important;
                padding-bottom: 30px !important;
            }
            #desktop-pin-toggle-btn { display: block; }
        }

        /* 강사소개 링크 데스크탑 네비게이션 스타일 (nav-section-item a 와 유사하게) */
        /* common_styles.css 에도 유사한 내용이 있을 수 있으나, 여기서 명시적으로 정의 */
        .page-navigation .nav-instructor-profile-link-wrapper {
            border-bottom: 1px solid var(--border-color); /* 모듈 그룹과 유사한 구분선 */
        }
        .page-navigation .nav-instructor-profile-link-wrapper a {
            display: block; text-decoration: none; color: #555; padding: 10px 15px;
            font-size: 0.9rem; transition: background-color 0.2s ease, color 0.2s ease;
             white-space: normal; overflow-wrap: break-word; word-break: keep-all;
             background-color: var(--section-list-bg); /* nav-section-list와 유사한 배경 */
             padding-left: 35px; /* nav-section-item a 와 패딩 맞춤 */
        }
        .page-navigation .nav-instructor-profile-link-wrapper a:hover {
            background-color: var(--secondary-color); color: var(--primary-color);
        }
        .page-navigation .nav-instructor-profile-link-wrapper.current-page a { /* 활성화 스타일 */
            background-color: var(--nav-active-bg) !important;
            color: var(--nav-active-text) !important;
            font-weight: 600; border-radius: 4px;
        }
    </style>
</head>
<body>
    <nav class="page-navigation" id="pageNav">
        <div class="nav-header">커리큘럼</div>
        <div class="nav-scroll-wrapper">
            <ul class="nav-curriculum-list">
                <li class="nav-module-group">
                    <div class="nav-module-title-wrapper" data-module-id="module1">
                        <span class="nav-module-title">Module 1: 왜 AI인가? 반복 업무 해방의 시작</span>
                        <span class="nav-toggle-icon">></span>
                    </div>
                    <ul class="nav-section-list">
                        <li class="nav-section-item"><a href="#" data-src="module1_section1.html">1. 오프닝: AI로 당신의 업무 시간을 되찾으세요!</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module1_section2.html">2. 당신의 하루, 혹시 이렇지 않나요? (업무 Pain Points)</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module1_section3.html">3. AI: 당신의 똑똑한 업무 비서 (생성형 AI란?)</a></li>
                    </ul>
                </li>
                <li class="nav-module-group">
                    <div class="nav-module-title-wrapper" data-module-id="module2">
                        <span class="nav-module-title">Module 2: AI와 제대로 소통하기 (ft. 핵심 도구)</span>
                        <span class="nav-toggle-icon">></span>
                    </div>
                    <ul class="nav-section-list">
                        <li class="nav-section-item"><a href="#" data-src="module2_section1.html">1. AI의 능력을 100% 끌어내는 '프롬프트' 작성법</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module2_section2.html">2. AI 특공대, 직접 다뤄보기 (주요 도구 시연)</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module2_section3.html">3. NotebookLM & Gemini 첫걸음</a></li>
                    </ul>
                </li>
                <li class="nav-module-group">
                    <div class="nav-module-title-wrapper" data-module-id="module3">
                        <span class="nav-module-title">Module 3: 실전! AI로 업무 효율 2배 UP! (시연 중심)</span>
                        <span class="nav-toggle-icon">></span>
                    </div>
                    <ul class="nav-section-list">
                         <li class="nav-section-item"><a href="#" data-src="module3_section1.html">1. 정보 검색 & 수집: AI로 10분 만에 끝내기!</a></li>
                         <li class="nav-section-item"><a href="#" data-src="module3_section2.html">2. 내 손안의 자료, AI로 지식 자산 만들기 (NotebookLM 활용)</a></li>
                         <li class="nav-section-item"><a href="#" data-src="module3_section3.html">3. 회의록 정리: AI로 5분 만에 핵심만 쏙!</a></li>
                         <li class="nav-section-item"><a href="#" data-src="module3_section4.html">4. 보고서·기획서 작성: AI로 시간 절반으로 줄이기!</a></li>
                    </ul>
                </li>
                <li class="nav-module-group">
                    <div class="nav-module-title-wrapper" data-module-id="module4">
                        <span class="nav-module-title">Module 4: AI, 안전하고 똑똑하게 활용하기</span>
                        <span class="nav-toggle-icon">></span>
                    </div>
                    <ul class="nav-section-list">
                        <li class="nav-section-item"><a href="#" data-src="module4_section1.html">1. AI, 안전하게 써야 진짜 전문가! (핵심 주의사항)</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module4_section2.html">2. (맛보기) AI로 내 업무 자동화하기 아이디어</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module4_section3.html">3. 마무리: AI 시대, 당신의 업무는 어떻게 바뀔까요?</a></li>
                    </ul>
                </li>
            </ul>
            <!-- 강사 소개 링크 추가 -->
            <div class="nav-instructor-profile-link-wrapper">
                <a href="#" data-src="instructor_profile.html">강사 소개</a>
            </div>
            <div class="nav-mainpage-link-wrapper">
                <a href="index.html" class="nav-mainpage-link">메인 커리큘럼</a>
            </div>
        </div>
    </nav>

    <main class="main-content-area" id="mainContent">
        <article id="contentDisplay">
            <!-- 초기 환영 메시지 또는 첫 번째 섹션 내용이 여기에 로드됩니다. -->
            <h1>환영합니다!</h1>
            <p>왼쪽 메뉴에 마우스를 올리거나 클릭하여 학습할 내용을 선택해주세요.</p>
            <p>모바일에서는 왼쪽 상단 햄버거 버튼을 이용해 메뉴를 열 수 있습니다.</p>
        </article>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const desktopNav = document.getElementById('pageNav');
            const desktopNavModuleTitles = desktopNav.querySelectorAll('.nav-module-title-wrapper');
            const desktopNavSectionLinks = desktopNav.querySelectorAll('.nav-section-item a');
            const desktopInstructorProfileLinkWrapper = desktopNav.querySelector('.nav-instructor-profile-link-wrapper');
            const desktopInstructorProfileLink = desktopNav.querySelector('.nav-instructor-profile-link-wrapper a');

            const contentDisplay = document.getElementById('contentDisplay');
            const mainContentArea = document.getElementById('mainContent');
            const sectionListPadding = 8; // 네비게이션 아코디언 섹션 리스트의 상하 패딩 값
            let currentActiveLinkElement = null; // 현재 활성화된 링크 요소 (강의 섹션 또는 강사소개)
            let currentScrollListener = null; // 현재 페이지의 슬라이드 스크롤 리스너
            let currentModuleStyleLink = null; // 현재 로드된 모듈/페이지 특정 스타일 시트
            let isMobile = window.innerWidth <= 768;
            let isDesktopNavPinned = false; // 데스크탑 네비게이션 고정 상태

            // --- UI 요소 동적 생성 (HTML에 직접 마크업하는 대신 JS로 생성하여 유연성 확보) ---
            const desktopPinToggleBtn = document.createElement('button');
            desktopPinToggleBtn.id = 'desktop-pin-toggle-btn';
            document.body.appendChild(desktopPinToggleBtn);

            const mobileHamburgerBtn = document.createElement('button');
            mobileHamburgerBtn.id = 'mobile-hamburger-btn';
            mobileHamburgerBtn.innerHTML = '☰'; // 햄버거 아이콘
            document.body.appendChild(mobileHamburgerBtn);

            const mobileSidebarContainer = document.createElement('div');
            mobileSidebarContainer.id = 'mobile-sidebar-container';
            document.body.appendChild(mobileSidebarContainer);

            const mobileSidebarCloseBtn = document.createElement('button');
            mobileSidebarCloseBtn.id = 'mobile-sidebar-close-btn';
            mobileSidebarCloseBtn.innerHTML = '×'; // 닫기 아이콘
            mobileSidebarContainer.appendChild(mobileSidebarCloseBtn);

            const mobileOverlay = document.createElement('div');
            mobileOverlay.id = 'mobile-overlay';
            document.body.appendChild(mobileOverlay);

            const pageNavButtonsContainer = document.createElement('div');
            pageNavButtonsContainer.id = 'page-navigation-buttons';
            const prevSectionBtn = document.createElement('button');
            prevSectionBtn.id = 'prev-section-button'; prevSectionBtn.textContent = '이전';
            const currentSectionNameDisplay = document.createElement('span');
            currentSectionNameDisplay.id = 'current-section-name-display';
            const nextSectionBtn = document.createElement('button');
            nextSectionBtn.id = 'next-section-button'; nextSectionBtn.textContent = '다음';
            pageNavButtonsContainer.appendChild(prevSectionBtn);
            pageNavButtonsContainer.appendChild(currentSectionNameDisplay);
            pageNavButtonsContainer.appendChild(nextSectionBtn);
            document.body.appendChild(pageNavButtonsContainer);

            // --- 모바일 사이드바 초기화 ---
            function initializeMobileSidebar() {
                const desktopNavHeader = desktopNav.querySelector('.nav-header');
                const desktopNavScrollWrapper = desktopNav.querySelector('.nav-scroll-wrapper');
                if (desktopNavHeader) mobileSidebarContainer.appendChild(desktopNavHeader.cloneNode(true));
                if (desktopNavScrollWrapper) mobileSidebarContainer.appendChild(desktopNavScrollWrapper.cloneNode(true));
                setupMobileSidebarInteractions(); // 복제된 요소에 이벤트 리스너 설정
            }

            // --- 모바일 사이드바 인터랙션 설정 ---
            function setupMobileSidebarInteractions() {
                const mobileNavModuleTitles = mobileSidebarContainer.querySelectorAll('.nav-module-title-wrapper');
                const mobileNavSectionLinks = mobileSidebarContainer.querySelectorAll('.nav-section-item a');
                const mobileInstructorProfileLink = mobileSidebarContainer.querySelector('.nav-instructor-profile-link-wrapper a');

                mobileNavModuleTitles.forEach(titleWrapper => {
                    titleWrapper.addEventListener('click', function () {
                        // 아코디언 펼치기/접기 로직
                        const isActive = this.classList.contains('active');
                        const sectionList = this.nextElementSibling;
                        // 다른 열린 아코디언 닫기 (선택적)
                        if (!isActive) {
                            mobileNavModuleTitles.forEach(otherHeader => {
                                if (otherHeader !== this && otherHeader.classList.contains('active')) {
                                    otherHeader.classList.remove('active');
                                    const otherList = otherHeader.nextElementSibling;
                                    if (otherList && otherList.classList.contains('nav-section-list')) {
                                        otherList.style.maxHeight = null; otherList.style.paddingTop = "0px"; otherList.style.paddingBottom = "0px";
                                    }
                                }
                            });
                        }
                        this.classList.toggle('active');
                        if (sectionList && sectionList.classList.contains('nav-section-list')) {
                            if (this.classList.contains('active')) {
                                sectionList.style.paddingTop = sectionListPadding + "px";
                                sectionList.style.paddingBottom = sectionListPadding + "px";
                                sectionList.style.maxHeight = (sectionList.scrollHeight + sectionListPadding * 2) + "px";
                            } else {
                                sectionList.style.maxHeight = null;
                                sectionList.style.paddingTop = "0px"; sectionList.style.paddingBottom = "0px";
                            }
                        }
                    });
                });

                mobileNavSectionLinks.forEach(link => {
                    link.addEventListener('click', function (event) {
                        event.preventDefault();
                        const filePath = this.dataset.src;
                        // 데스크탑 네비게이션의 해당 링크를 찾아 하이라이트 기준점으로 사용
                        const originalLink = Array.from(desktopNavSectionLinks).find(dLink => dLink.dataset.src === filePath);
                        if (originalLink) {
                            loadAndDisplayContent(filePath, originalLink, false); // isProfilePage = false
                        }
                        toggleMobileSidebar(false); // 사이드바 닫기
                    });
                });

                if (mobileInstructorProfileLink) {
                    mobileInstructorProfileLink.addEventListener('click', function(event) {
                        event.preventDefault();
                        const filePath = this.dataset.src;
                        // 데스크탑 네비게이션의 강사소개 링크를 하이라이트 기준점으로 사용
                        loadAndDisplayContent(filePath, desktopInstructorProfileLink, true); // isProfilePage = true
                        toggleMobileSidebar(false);
                    });
                }
            }

            // --- 화면 크기 변경에 따른 UI 업데이트 ---
            function updateUIBasedOnMode() {
                isMobile = window.innerWidth <= 768;
                if (isMobile) {
                    desktopPinToggleBtn.style.display = 'none';
                    mobileHamburgerBtn.style.display = 'block';
                    pageNavButtonsContainer.style.display = 'flex';
                    if (desktopNav.classList.contains('pinned')) { // 모바일로 전환 시 고정 해제
                        desktopNav.classList.remove('pinned');
                        document.body.classList.remove('desktop-nav-pinned');
                        isDesktopNavPinned = false; // 상태 업데이트
                    }
                } else { // 데스크탑 모드
                    desktopPinToggleBtn.style.display = 'block';
                    mobileHamburgerBtn.style.display = 'none';
                    mobileSidebarContainer.classList.remove('open'); // 사이드바 닫기
                    mobileOverlay.classList.remove('active'); // 오버레이 숨기기
                    pageNavButtonsContainer.style.display = 'none';
                    // 데스크탑 네비 고정 상태 복원
                    if (isDesktopNavPinned) {
                        desktopNav.classList.add('pinned');
                        desktopPinToggleBtn.classList.add('pinned-icon');
                        desktopPinToggleBtn.setAttribute('aria-label', '네비게이션 고정 해제');
                        document.body.classList.add('desktop-nav-pinned');
                    } else {
                        desktopNav.classList.remove('pinned');
                        desktopPinToggleBtn.classList.remove('pinned-icon');
                        desktopPinToggleBtn.setAttribute('aria-label', '네비게이션 고정');
                        document.body.classList.remove('desktop-nav-pinned');
                    }
                }
                updatePageNavigationButtonsState(); // 이전/다음 버튼 상태 업데이트
            }

            // --- 모바일 사이드바 토글 ---
            function toggleMobileSidebar(show) {
                if (show) {
                    mobileSidebarContainer.classList.add('open');
                    mobileOverlay.classList.add('active');
                } else {
                    mobileSidebarContainer.classList.remove('open');
                    mobileOverlay.classList.remove('active');
                }
            }
            mobileHamburgerBtn.addEventListener('click', () => toggleMobileSidebar(true));
            mobileOverlay.addEventListener('click', () => toggleMobileSidebar(false));
            mobileSidebarCloseBtn.addEventListener('click', () => toggleMobileSidebar(false));

            // --- 데스크탑 네비게이션 고정 토글 ---
            desktopPinToggleBtn.addEventListener('click', function() {
                if (isMobile) return; // 모바일에선 작동 안 함
                isDesktopNavPinned = !isDesktopNavPinned;
                updateUIBasedOnMode(); // UI 업데이트 호출
            });

            // --- 데스크탑 네비게이션 아코디언 ---
            desktopNavModuleTitles.forEach(titleWrapper => {
                titleWrapper.addEventListener('click', function () {
                    if (isMobile) return; // 모바일에선 데스크탑 아코디언 직접 제어 안 함
                    // 아코디언 펼치기/접기 로직 (모바일과 동일)
                    const isActive = this.classList.contains('active');
                    const sectionList = this.nextElementSibling;
                    if (!isActive) {
                         desktopNavModuleTitles.forEach(otherHeader => {
                            if (otherHeader !== this && otherHeader.classList.contains('active')) {
                                otherHeader.classList.remove('active');
                                const otherList = otherHeader.nextElementSibling;
                                if (otherList && otherList.classList.contains('nav-section-list')) {
                                    otherList.style.maxHeight = null; otherList.style.paddingTop = "0px"; otherList.style.paddingBottom = "0px";
                                }
                            }
                        });
                    }
                    this.classList.toggle('active');
                    if (sectionList && sectionList.classList.contains('nav-section-list')) {
                        if (this.classList.contains('active')) {
                            sectionList.style.paddingTop = sectionListPadding + "px";
                            sectionList.style.paddingBottom = sectionListPadding + "px";
                            sectionList.style.maxHeight = (sectionList.scrollHeight + sectionListPadding * 2) + "px";
                        } else {
                             sectionList.style.maxHeight = null;
                             sectionList.style.paddingTop = "0px"; sectionList.style.paddingBottom = "0px";
                        }
                    }
                });
            });

            // --- 데스크탑 네비게이션 링크 클릭 이벤트 (강의 섹션) ---
            desktopNavSectionLinks.forEach(link => {
                 link.addEventListener('click', function (event) {
                    event.preventDefault();
                    if (isMobile && event.target.closest('#pageNav')) return; // 모바일에서 데스크탑 네비 직접 클릭 방지
                    loadAndDisplayContent(this.dataset.src, this, false); // isProfilePage = false
                });
            });

            // --- 데스크탑 네비게이션 링크 클릭 이벤트 (강사 소개) ---
            if (desktopInstructorProfileLink) {
                desktopInstructorProfileLink.addEventListener('click', function(event){
                    event.preventDefault();
                    if (isMobile && event.target.closest('#pageNav')) return;
                    loadAndDisplayContent(this.dataset.src, this, true); // isProfilePage = true
                });
            }

            // --- 콘텐츠 로드 및 표시 함수 ---
            async function loadAndDisplayContent(filePath, linkElementToHighlight, isProfilePage = false) {
                // 1. 이전 활성 링크 스타일 제거
                if (currentActiveLinkElement) {
                    // currentActiveLinkElement는 실제 a 태그, 그것의 부모(li 또는 div)에 current-page 클래스 적용
                    if(currentActiveLinkElement.parentElement.classList.contains('nav-section-item') ||
                       currentActiveLinkElement.parentElement.classList.contains('nav-instructor-profile-link-wrapper')) {
                        currentActiveLinkElement.parentElement.classList.remove('current-page');
                    }
                }
                // 모든 섹션 링크와 강사 프로필 링크에서 'current-page' 제거 (중복 방지)
                desktopNavSectionLinks.forEach(l => l.parentElement.classList.remove('current-page'));
                if (desktopInstructorProfileLinkWrapper) {
                    desktopInstructorProfileLinkWrapper.classList.remove('current-page');
                }

                // 2. 새 활성 링크 스타일 적용
                linkElementToHighlight.parentElement.classList.add('current-page');
                currentActiveLinkElement = linkElementToHighlight; // 현재 활성 링크 업데이트

                // 3. 모바일 하단 바에 현재 섹션 이름 표시
                if (isMobile && currentSectionNameDisplay) {
                    let sectionName = linkElementToHighlight.textContent || "";
                    // "1. 오프닝..." 에서 "오프닝..." 부분만 추출 (강사소개는 그대로)
                    if (!isProfilePage) {
                        const dotIndex = sectionName.indexOf('.');
                        if (dotIndex !== -1 && sectionName.length > dotIndex + 1) {
                            sectionName = sectionName.substring(dotIndex + 1).trim();
                        }
                    }
                    currentSectionNameDisplay.textContent = sectionName;
                }

                // 4. 브라우저 히스토리 및 해시 업데이트
                const newHash = filePath.split('.')[0]; // "module1_section1.html" -> "module1_section1"
                if(window.location.hash !== `#${newHash}`) {
                    // history.pushState(null, null, `#${newHash}`); // 새 히스토리 항목 추가
                    history.replaceState(null, null, `#${newHash}`); // 현재 히스토리 항목 대체 (뒤로가기 시 이전 페이지로)
                }


                // 5. 콘텐츠 로딩 애니메이션 시작
                contentDisplay.classList.remove('loaded');
                contentDisplay.style.opacity = '0';
                contentDisplay.innerHTML = '<p style="text-align:center; padding: 20px;">로딩 중...</p>';
                contentDisplay.dataset.loadedFile = filePath; // 현재 로드된 파일 정보 저장 (디버깅용)

                // 6. 이전 모듈/페이지 특정 스타일 제거
                if (currentModuleStyleLink) {
                    currentModuleStyleLink.remove();
                    currentModuleStyleLink = null;
                }

                // 7. 새 모듈/페이지 특정 스타일 로드
                let styleHref = '';
                if (filePath === 'instructor_profile.html') {
                    styleHref = 'css/instructor_profile_styles.css';
                } else {
                    const moduleMatch = filePath.match(/module(\d+)_section(\w+)\.html/);
                    if (moduleMatch && moduleMatch[1]) {
                        // 예: "css/module1_section1_styles.css"
                        styleHref = `css/module${moduleMatch[1]}_section${moduleMatch[2]}_styles.css`;
                    }
                }

                if (styleHref) {
                    const newStyleLink = document.createElement('link');
                    newStyleLink.rel = 'stylesheet';
                    newStyleLink.type = 'text/css';
                    newStyleLink.href = styleHref;
                    document.head.appendChild(newStyleLink);
                    currentModuleStyleLink = newStyleLink;
                }

                // 8. 이전 스크롤 리스너 제거
                if (currentScrollListener) {
                    mainContentArea.removeEventListener('scroll', currentScrollListener);
                    currentScrollListener = null;
                }

                // 9. 새 콘텐츠 fetch 및 표시
                try {
                    const response = await fetch(filePath);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status} for ${filePath}`);
                    }
                    contentDisplay.innerHTML = await response.text();

                    // 10. 슬라이드가 있는 페이지의 경우 슬라이드 초기화 및 스크롤 리스너 설정
                    if (!isProfilePage) { // 강사소개 페이지는 슬라이드 없음
                        const loadedSlideContainer = contentDisplay.querySelector('.slide-container');
                        if (loadedSlideContainer) {
                            currentScrollListener = initializeSlidesForCurrentPage(loadedSlideContainer, mainContentArea);
                            if (currentScrollListener) {
                                mainContentArea.addEventListener('scroll', currentScrollListener);
                                currentScrollListener(); // 초기 뷰 체크
                            }
                        }
                    }
                } catch (error) {
                    console.error('Error loading content:', error);
                    contentDisplay.innerHTML = `<div style="padding:20px; text-align:center; color:red;"><h2>오류 발생</h2><p>콘텐츠를 불러오는 중 문제가 발생했습니다.</p><p>${error.message}</p><p>파일 경로(${filePath})를 확인해주세요.</p></div>`;
                } finally {
                    // 11. 콘텐츠 로딩 애니메이션 완료 및 스크롤 상단 이동
                    setTimeout(() => {
                        contentDisplay.style.opacity = '1';
                        contentDisplay.classList.add('loaded');
                    }, 50); // 약간의 딜레이 후 표시하여 부드러운 전환 효과
                    mainContentArea.scrollTop = 0; // 새 콘텐츠 로드 시 스크롤 상단으로

                    // 12. 이전/다음 버튼 상태 업데이트
                    updatePageNavigationButtonsState();

                    // 13. 모바일 사이드바에도 현재 페이지 반영
                    if (isMobile) {
                        const mobileLinks = mobileSidebarContainer.querySelectorAll('.nav-section-item a');
                        const mobileProfileLinkWrapper = mobileSidebarContainer.querySelector('.nav-instructor-profile-link-wrapper');

                        mobileLinks.forEach(ml => ml.parentElement.classList.remove('current-page'));
                        if (mobileProfileLinkWrapper) mobileProfileLinkWrapper.classList.remove('current-page');

                        if (isProfilePage) {
                             if (mobileProfileLinkWrapper) mobileProfileLinkWrapper.classList.add('current-page');
                        } else {
                            const activeMobileLink = Array.from(mobileLinks).find(ml => ml.dataset.src === filePath);
                            if (activeMobileLink) activeMobileLink.parentElement.classList.add('current-page');
                        }
                    }
                }
            }

            // --- 현재 페이지 슬라이드 초기화 및 스크롤 리스너 반환 ---
            function initializeSlidesForCurrentPage(container, scroller) {
                const slides = container.querySelectorAll('.slide');
                if (slides.length === 0) return null;

                // 모든 슬라이드의 active 클래스 초기화
                slides.forEach(slide => slide.classList.remove('active'));
                // 첫 번째 슬라이드는 바로 active (선택적)
                // if (slides.length > 0) slides[0].classList.add('active');


                const checkSlidesInView = function() {
                    slides.forEach(slide => {
                        const slideRect = slide.getBoundingClientRect();
                        // scroller는 mainContentArea
                        const scrollerRect = scroller.getBoundingClientRect();
                        const slideTopInScroller = slideRect.top - scrollerRect.top; // 스크롤러 상단 기준 슬라이드 상단 위치
                        const scrollerHeight = scroller.clientHeight;

                        // 슬라이드가 뷰포트의 특정 영역에 들어오면 active 클래스 추가
                        // (예: 슬라이드 상단이 뷰포트 하단 85% 지점보다 위에 있고, 슬라이드 하단이 뷰포트 상단 15% 지점보다 아래에 있을 때)
                        if (slideTopInScroller < scrollerHeight * 0.85 && (slideTopInScroller + slide.offsetHeight) > scrollerHeight * 0.15) {
                            slide.classList.add('active');
                        }
                        // else { slide.classList.remove('active'); } // 뷰 벗어나면 active 제거 (선택적)
                    });
                };
                return checkSlidesInView;
            }

            // --- 링크의 부모 모듈 아코디언 활성화 ---
            function activateParentModuleOfLink(linkElement) {
                // 강사 소개 링크는 모듈에 속하지 않으므로 모든 모듈 아코디언을 닫음
                if (linkElement.dataset.src === 'instructor_profile.html') {
                    // 데스크탑 아코디언 닫기
                    desktopNavModuleTitles.forEach(header => {
                        if (header.classList.contains('active')) {
                            header.classList.remove('active');
                            const sectionList = header.nextElementSibling;
                            if (sectionList) { sectionList.style.maxHeight = null; sectionList.style.paddingTop = "0px"; sectionList.style.paddingBottom = "0px"; }
                        }
                    });
                    // 모바일 아코디언 닫기
                    if (isMobile) {
                        const mobileNavModuleTitles = mobileSidebarContainer.querySelectorAll('.nav-module-title-wrapper');
                        mobileNavModuleTitles.forEach(header => {
                            if (header.classList.contains('active')) {
                                header.classList.remove('active');
                                const sectionList = header.nextElementSibling;
                                if (sectionList) { sectionList.style.maxHeight = null; sectionList.style.paddingTop = "0px"; sectionList.style.paddingBottom = "0px"; }
                            }
                        });
                    }
                    return; // 더 이상 진행 안 함
                }

                // 강의 섹션 링크의 경우
                const parentModuleGroup = linkElement.closest('.nav-module-group');
                if (!parentModuleGroup) return;
                const parentModuleTitleWrapperDesktop = parentModuleGroup.querySelector('.nav-module-title-wrapper');
                if (!parentModuleTitleWrapperDesktop) return;

                const moduleId = parentModuleTitleWrapperDesktop.dataset.moduleId;

                // 데스크탑 아코디언 펼치기
                if (!isMobile && !parentModuleTitleWrapperDesktop.classList.contains('active')) {
                    desktopNavModuleTitles.forEach(otherHeader => { // 다른 열린 모듈 닫기
                        if (otherHeader !== parentModuleTitleWrapperDesktop && otherHeader.classList.contains('active')) {
                            otherHeader.classList.remove('active');
                            const otherList = otherHeader.nextElementSibling;
                            if (otherList) { otherList.style.maxHeight = null; otherList.style.paddingTop = "0px"; otherList.style.paddingBottom = "0px"; }
                        }
                    });
                    parentModuleTitleWrapperDesktop.classList.add('active');
                    const sectionListToOpenDesktop = parentModuleTitleWrapperDesktop.nextElementSibling;
                    if (sectionListToOpenDesktop) {
                        sectionListToOpenDesktop.style.paddingTop = sectionListPadding + "px";
                        sectionListToOpenDesktop.style.paddingBottom = sectionListPadding + "px";
                        sectionListToOpenDesktop.style.maxHeight = (sectionListToOpenDesktop.scrollHeight + sectionListPadding * 2) + "px";
                    }
                }
                // 모바일 아코디언 펼치기 (사이드바가 열릴 때 적용됨)
                if (isMobile) {
                    const mobileNavModuleTitles = mobileSidebarContainer.querySelectorAll('.nav-module-title-wrapper');
                    const parentModuleTitleMobile = Array.from(mobileNavModuleTitles).find(mTitle => mTitle.dataset.moduleId === moduleId);
                    if (parentModuleTitleMobile && !parentModuleTitleMobile.classList.contains('active')) {
                        mobileNavModuleTitles.forEach(otherHeader => { // 다른 열린 모듈 닫기
                            if (otherHeader !== parentModuleTitleMobile && otherHeader.classList.contains('active')) {
                                otherHeader.classList.remove('active');
                                const otherList = otherHeader.nextElementSibling;
                                if (otherList) { otherList.style.maxHeight = null; otherList.style.paddingTop = "0px"; otherList.style.paddingBottom = "0px"; }
                            }
                        });
                        parentModuleTitleMobile.classList.add('active');
                        const sectionListToOpenMobile = parentModuleTitleMobile.nextElementSibling;
                        if (sectionListToOpenMobile) {
                            sectionListToOpenMobile.style.paddingTop = sectionListPadding + "px";
                            sectionListToOpenMobile.style.paddingBottom = sectionListPadding + "px";
                            sectionListToOpenMobile.style.maxHeight = (sectionListToOpenMobile.scrollHeight + sectionListPadding * 2) + "px";
                        }
                    }
                }
            }

            // --- URL 해시 변경 감지 및 해당 콘텐츠 로드 ---
            function loadContentFromHash() {
                const hash = window.location.hash.substring(1); // "#" 제거
                if (hash) {
                    let targetLink;
                    let isProfile = false;
                    if (hash === 'instructor_profile') { // 강사소개 해시 처리
                        targetLink = desktopInstructorProfileLink;
                        isProfile = true;
                    } else { // 강의 섹션 해시 처리
                        targetLink = Array.from(desktopNavSectionLinks).find(link => link.dataset.src.split('.')[0] === hash);
                    }

                    if (targetLink) {
                        loadAndDisplayContent(targetLink.dataset.src, targetLink, isProfile);
                        activateParentModuleOfLink(targetLink); // 부모 모듈 아코디언 열기
                    } else {
                        // 해시에 해당하는 링크가 없으면 초기 콘텐츠 로드
                        loadInitialContent();
                    }
                } else {
                    // 해시가 없으면 초기 콘텐츠 로드
                    loadInitialContent();
                }
            }

            // --- 초기 콘텐츠 로드 (페이지 첫 로드 또는 유효하지 않은 해시) ---
            function loadInitialContent() {
                // 기본적으로 첫 번째 강의 섹션을 로드
                const firstValidLink = desktopNav.querySelector('.nav-section-item a[data-src]');
                if (firstValidLink) {
                    loadAndDisplayContent(firstValidLink.dataset.src, firstValidLink, false);
                    activateParentModuleOfLink(firstValidLink);
                } else {
                    // 로드할 강의가 없으면 환영 메시지 표시
                    contentDisplay.innerHTML = '<h1>환영합니다!</h1><p>학습할 내용을 선택해주세요.</p>';
                    contentDisplay.classList.add('loaded'); // 로드 완료 클래스 추가
                    if (isMobile && currentSectionNameDisplay) currentSectionNameDisplay.textContent = '환영합니다!';
                    updatePageNavigationButtonsState(); // 이전/다음 버튼 상태 업데이트
                }
            }

            // --- 모바일 하단 이전/다음 버튼 상태 업데이트 ---
            function updatePageNavigationButtonsState() {
                // 강사소개 페이지에서는 이전/다음 버튼 비활성화
                if (!currentActiveLinkElement || currentActiveLinkElement.dataset.src === 'instructor_profile.html') {
                    prevSectionBtn.disabled = true;
                    nextSectionBtn.disabled = true;
                    // currentSectionNameDisplay는 loadAndDisplayContent에서 이미 처리됨
                    return;
                }

                // 강의 섹션 페이지에서만 동작
                const allDesktopLinksArray = Array.from(desktopNavSectionLinks); // 강의 섹션 링크만 포함
                const currentIndex = allDesktopLinksArray.findIndex(link => link === currentActiveLinkElement);

                prevSectionBtn.disabled = !(currentIndex > 0);
                prevSectionBtn.onclick = (currentIndex > 0) ? () => {
                    const prevLink = allDesktopLinksArray[currentIndex - 1];
                    loadAndDisplayContent(prevLink.dataset.src, prevLink, false);
                    activateParentModuleOfLink(prevLink);
                } : null;

                nextSectionBtn.disabled = !(currentIndex >= 0 && currentIndex < allDesktopLinksArray.length - 1);
                nextSectionBtn.onclick = (currentIndex >= 0 && currentIndex < allDesktopLinksArray.length - 1) ? () => {
                    const nextLink = allDesktopLinksArray[currentIndex + 1];
                    loadAndDisplayContent(nextLink.dataset.src, nextLink, false);
                    activateParentModuleOfLink(nextLink);
                } : null;
            }

            // --- 강사 소개 페이지에서 "커리큘럼으로 돌아가기" 버튼 기능 ---
            // 이 함수는 instructor_profile.html 내의 버튼에서 onclick으로 호출되므로 전역 스코프에 있어야 함
            window.goBackToCurriculum = function() {
                // 예: 첫 번째 강의 섹션으로 이동
                const firstLectureLink = document.querySelector('.nav-section-item a[data-src^="module1_section1"]');
                if (firstLectureLink) {
                    // 해시 변경을 통해 loadContentFromHash 함수가 트리거되도록 함
                    window.location.hash = firstLectureLink.dataset.src.split('.')[0];
                } else {
                    // 첫 번째 강의 링크를 찾지 못하면 기본 해시로 (초기 콘텐츠 로드 유도)
                    window.location.hash = '';
                }
            }

            // --- 초기화 실행 ---
            initializeMobileSidebar(); // 모바일 사이드바 구조 복제 및 이벤트 설정
            updateUIBasedOnMode(); // 현재 화면 크기에 맞게 UI 설정
            window.addEventListener('resize', updateUIBasedOnMode); // 화면 크기 변경 감지
            loadContentFromHash(); // URL 해시 기반으로 초기 콘텐츠 로드
            window.addEventListener('hashchange', loadContentFromHash); // 해시 변경 감지

        });
    </script>
</body>
</html>
