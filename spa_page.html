<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI, 건설 업무의 시간을 되돌려 드립니다! - 커리큘럼</title>
    <link rel="stylesheet" href="css/common_styles.css"> <!-- 기존 CSS 파일 유지 -->
    <!-- 모듈별 CSS는 JavaScript로 동적 로드 -->
    <style>
        /* 모바일 전용 스타일 */
        @media (max-width: 768px) {
            /* 데스크탑 네비게이션의 hover 효과 및 직접적 상호작용 제한 */
            .page-navigation {
                pointer-events: none; /* 모바일에서는 hover 및 클릭 방지 */
                opacity: 0 !important; /* 시각적으로도 완전히 숨김 */
                width: 0 !important; /* 공간 차지하지 않도록 */
                border-right: none !important;
            }

            /* 모바일 햄버거 버튼 */
            #mobile-hamburger-btn {
                display: block; /* 모바일에서만 보임 */
                position: fixed;
                top: 15px;
                left: 15px;
                z-index: 1002;
                background-color: var(--primary-color, #3155e2); /* common_styles.css 변수 사용 시도 */
                color: white;
                border: none;
                padding: 8px 12px;
                font-size: 20px;
                cursor: pointer;
                border-radius: 5px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            }

            /* 모바일 사이드바 컨테이너 */
            #mobile-sidebar-container {
                position: fixed;
                top: 0;
                left: 0;
                width: 280px; /* 모바일 사이드바 너비 */
                height: 100vh;
                background-color: var(--nav-bg-expanded, #fff); /* common_styles.css 변수 사용 시도 */
                z-index: 1001;
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
                overflow-y: auto;
                box-shadow: 2px 0 5px rgba(0,0,0,0.1);
                padding-top: 50px; /* 닫기 버튼을 위한 공간 */
            }
            #mobile-sidebar-container.open {
                transform: translateX(0);
            }

            /* 모바일 사이드바 닫기 버튼 */
            #mobile-sidebar-close-btn {
                position: absolute;
                top: 15px;
                right: 15px;
                font-size: 24px;
                background: none;
                border: none;
                color: var(--primary-color, #3155e2);
                cursor: pointer;
            }

            /* 모바일 사이드바 내부 스타일 (기존 .nav-header, .nav-scroll-wrapper 등 재활용) */
            #mobile-sidebar-container .nav-header,
            #mobile-sidebar-container .nav-scroll-wrapper {
                opacity: 1 !important; /* 항상 보이도록 */
                width: 100% !important;
            }
            #mobile-sidebar-container .nav-header { /* common_styles.css 와 충돌 피하기 위해 !important 사용 가능성 */
                padding-top: 10px; /* 위에서 이미 줬으므로 조정 */
                border-bottom: 1px solid var(--border-color, #eaeaea);
            }
             #mobile-sidebar-container .nav-scroll-wrapper {
                padding: 15px 0; /* common_styles.css 와 동일하게 */
             }


            /* 모바일 오버레이 */
            #mobile-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.5);
                z-index: 1000;
            }
            #mobile-overlay.active {
                display: block;
            }

            /* 메인 콘텐츠 영역 패딩 (햄버거 버튼 및 이전/다음 버튼 공간) */
            .main-content-area {
                padding-top: 60px !important; /* !important 로 common_styles.css 우선순위 덮기 */
                padding-bottom: 80px !important;
            }

            /* 모바일 이전/다음 버튼 (기존 스타일 유지) */
            #page-navigation-buttons {
                display: none; /* JS로 제어 */
                /* ... (나머지 스타일은 이전과 동일하게 유지) ... */
                position: fixed; bottom: 0; left: 0; width: 100%;
                padding: 10px 15px; background-color: rgba(250, 250, 250, 0.95);
                box-shadow: 0 -2px 8px rgba(0,0,0,0.1); z-index: 999;
                justify-content: space-between; align-items: center;
                backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
            }
            #page-navigation-buttons button {
                padding: 10px 15px; font-size: 0.9em; font-weight: 500;
                background-color: var(--primary-color, #3155e2); color: white; border: none;
                border-radius: 5px; cursor: pointer; transition: background-color 0.2s ease;
                min-width: 70px; text-align: center;
            }
            #page-navigation-buttons button:hover:not(:disabled) { background-color: #2a49c7; }
            #page-navigation-buttons button:disabled { background-color: #ccc; color: #777; cursor: not-allowed; opacity: 0.7; }
        }

        /* 데스크탑에서는 모바일 UI 요소 숨김 */
        @media (min-width: 769px) {
            #mobile-hamburger-btn,
            #mobile-sidebar-container,
            #mobile-overlay,
            #page-navigation-buttons { /* 이전/다음 버튼도 데스크탑에선 숨김 */
                display: none !important;
            }
            /* 데스크탑 네비게이션 원상 복구 (모바일에서 !important로 변경한 값들) */
            .page-navigation {
                pointer-events: auto !important;
                opacity: 0.7 !important; /* common_styles.css의 기본값으로 */
                width: var(--nav-collapsed-width) !important; /* common_styles.css의 기본값으로 */
                border-right: 1px solid var(--border-color, #eaeaea) !important;
            }
            .main-content-area { /* 데스크탑 패딩 원상복구 */
                padding-top: 30px !important;
                padding-bottom: 30px !important;
            }
        }
    </style>
</head>
<body>
    <!-- 데스크탑용 네비게이션 (기존 HTML 그대로 사용) -->
    <nav class="page-navigation" id="pageNav">
        <div class="nav-header">커리큘럼</div>
        <div class="nav-scroll-wrapper">
            <ul class="nav-curriculum-list">
                <li class="nav-module-group">
                    <div class="nav-module-title-wrapper" data-module-id="module1">
                        <span class="nav-module-title">Module 1: 왜 AI인가? 반복 업무 해방의 시작</span>
                        <span class="nav-toggle-icon">></span>
                    </div>
                    <ul class="nav-section-list">
                        <li class="nav-section-item"><a href="#" data-src="module1_section1.html">1. 오프닝: AI로 당신의 업무 시간을 되찾으세요!</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module1_section2.html">2. 당신의 하루, 혹시 이렇지 않나요? (업무 Pain Points)</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module1_section3.html">3. AI: 당신의 똑똑한 업무 비서 (생성형 AI란?)</a></li>
                    </ul>
                </li>
                <li class="nav-module-group">
                    <div class="nav-module-title-wrapper" data-module-id="module2">
                        <span class="nav-module-title">Module 2: AI와 제대로 소통하기 (ft. 핵심 도구)</span>
                        <span class="nav-toggle-icon">></span>
                    </div>
                    <ul class="nav-section-list">
                        <li class="nav-section-item"><a href="#" data-src="module2_section1.html">1. AI의 능력을 100% 끌어내는 '프롬프트' 작성법</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module2_section2.html">2. AI 특공대, 직접 다뤄보기 (주요 도구 시연)</a></li>
                    </ul>
                </li>
                <li class="nav-module-group">
                    <div class="nav-module-title-wrapper" data-module-id="module3">
                        <span class="nav-module-title">Module 3: 실전! AI로 업무 효율 2배 UP! (시연 중심)</span>
                        <span class="nav-toggle-icon">></span>
                    </div>
                    <ul class="nav-section-list">
                         <li class="nav-section-item"><a href="#" data-src="module3_section1.html">1. 정보 검색 & 수집: AI로 10분 만에 끝내기!</a></li>
                         <li class="nav-section-item"><a href="#" data-src="module3_section2.html">2. 내 손안의 자료, AI로 지식 자산 만들기 (NotebookLM 활용)</a></li>
                         <li class="nav-section-item"><a href="#" data-src="module3_section3.html">3. 회의록 정리: AI로 5분 만에 핵심만 쏙!</a></li>
                         <li class="nav-section-item"><a href="#" data-src="module3_section4.html">4. 보고서·기획서 작성: AI로 시간 절반으로 줄이기!</a></li>
                    </ul>
                </li>
                <li class="nav-module-group">
                    <div class="nav-module-title-wrapper" data-module-id="module4">
                        <span class="nav-module-title">Module 4: AI, 안전하고 똑똑하게 활용하기</span>
                        <span class="nav-toggle-icon">></span>
                    </div>
                    <ul class="nav-section-list">
                        <li class="nav-section-item"><a href="#" data-src="module4_section1.html">1. AI, 안전하게 써야 진짜 전문가! (핵심 주의사항)</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module4_section2.html">2. (맛보기) AI로 내 업무 자동화하기 아이디어</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module4_section3.html">3. 마무리: AI 시대, 당신의 업무는 어떻게 바뀔까요?</a></li>
                    </ul>
                </li>
            </ul>
            <div class="nav-mainpage-link-wrapper">
                <a href="index.html" class="nav-mainpage-link">메인 페이지</a>
            </div>
        </div>
    </nav>

    <main class="main-content-area" id="mainContent">
        <article id="contentDisplay">
            <h1>환영합니다!</h1>
            <p>왼쪽 메뉴에 마우스를 올리면 전체 목차가 나타납니다. 학습할 내용을 선택해주세요.</p>
        </article>
    </main>

    <!-- 모바일용 UI 요소 (JS로 생성 및 제어) -->
    <!-- <button id="mobile-hamburger-btn">☰</button> -->
    <!-- <div id="mobile-sidebar-container"> -->
        <!-- <button id="mobile-sidebar-close-btn">×</button> -->
        <!-- (네비게이션 내용이 JS로 복제됨) -->
    <!-- </div> -->
    <!-- <div id="mobile-overlay"></div> -->
    <!-- <div id="page-navigation-buttons">...</div> -->


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // 기존 (데스크탑) 네비게이션 요소
            const desktopNav = document.getElementById('pageNav');
            const desktopNavModuleTitles = desktopNav.querySelectorAll('.nav-module-title-wrapper');
            const desktopNavSectionLinks = desktopNav.querySelectorAll('.nav-section-item a');

            const contentDisplay = document.getElementById('contentDisplay');
            const mainContentArea = document.getElementById('mainContent'); // 스크롤 리스너 및 스크롤 초기화용
            const sectionListPadding = 8;
            let currentActiveLinkElement = null; // 항상 데스크탑 네비게이션의 링크를 기준으로 관리
            let currentScrollListener = null;
            let currentModuleStyleLink = null;
            let isMobile = window.innerWidth <= 768;

            // --- 모바일 UI 요소 생성 ---
            const hamburgerBtn = document.createElement('button');
            hamburgerBtn.id = 'mobile-hamburger-btn';
            hamburgerBtn.innerHTML = '☰';
            document.body.appendChild(hamburgerBtn);

            const mobileSidebarContainer = document.createElement('div');
            mobileSidebarContainer.id = 'mobile-sidebar-container';
            document.body.appendChild(mobileSidebarContainer);

            const mobileSidebarCloseBtn = document.createElement('button');
            mobileSidebarCloseBtn.id = 'mobile-sidebar-close-btn';
            mobileSidebarCloseBtn.innerHTML = '×';
            mobileSidebarContainer.appendChild(mobileSidebarCloseBtn);

            const mobileOverlay = document.createElement('div');
            mobileOverlay.id = 'mobile-overlay';
            document.body.appendChild(mobileOverlay);

            const pageNavButtonsContainer = document.createElement('div'); // 이전/다음 버튼용
            pageNavButtonsContainer.id = 'page-navigation-buttons';
            const prevSectionBtn = document.createElement('button');
            prevSectionBtn.id = 'prev-section-button'; prevSectionBtn.textContent = '이전';
            const nextSectionBtn = document.createElement('button');
            nextSectionBtn.id = 'next-section-button'; nextSectionBtn.textContent = '다음';
            pageNavButtonsContainer.appendChild(prevSectionBtn);
            pageNavButtonsContainer.appendChild(nextSectionBtn);
            document.body.appendChild(pageNavButtonsContainer);


            // --- 모바일 사이드바 내용 복제 및 이벤트 설정 ---
            function initializeMobileSidebar() {
                const desktopNavHeader = desktopNav.querySelector('.nav-header');
                const desktopNavScrollWrapper = desktopNav.querySelector('.nav-scroll-wrapper');

                if (desktopNavHeader) {
                    const clonedHeader = desktopNavHeader.cloneNode(true);
                    // 모바일에서는 항상 보이도록 opacity 제거 또는 1로 설정 (CSS에서 처리)
                    mobileSidebarContainer.appendChild(clonedHeader);
                }
                if (desktopNavScrollWrapper) {
                    const clonedScrollWrapper = desktopNavScrollWrapper.cloneNode(true);
                    mobileSidebarContainer.appendChild(clonedScrollWrapper);
                }
                setupMobileSidebarInteractions();
            }

            function setupMobileSidebarInteractions() {
                const mobileNavModuleTitles = mobileSidebarContainer.querySelectorAll('.nav-module-title-wrapper');
                const mobileNavSectionLinks = mobileSidebarContainer.querySelectorAll('.nav-section-item a');

                mobileNavModuleTitles.forEach(titleWrapper => {
                    titleWrapper.addEventListener('click', function () {
                        // 모바일 아코디언 로직 (기존과 동일, 대상만 모바일)
                        const isActive = this.classList.contains('active');
                        const sectionList = this.nextElementSibling;
                        if (!isActive) {
                            mobileNavModuleTitles.forEach(otherHeader => {
                                if (otherHeader !== this && otherHeader.classList.contains('active')) {
                                    otherHeader.classList.remove('active');
                                    const otherList = otherHeader.nextElementSibling;
                                    if (otherList && otherList.classList.contains('nav-section-list')) {
                                        otherList.style.maxHeight = null; otherList.style.paddingTop = "0px"; otherList.style.paddingBottom = "0px";
                                    } } }); }
                        this.classList.toggle('active');
                        if (sectionList && sectionList.classList.contains('nav-section-list')) {
                            if (this.classList.contains('active')) {
                                sectionList.style.paddingTop = sectionListPadding + "px"; sectionList.style.paddingBottom = sectionListPadding + "px";
                                sectionList.style.maxHeight = (sectionList.scrollHeight + sectionListPadding * 2) + "px";
                            } else {
                                sectionList.style.maxHeight = null; sectionList.style.paddingTop = "0px"; sectionList.style.paddingBottom = "0px";
                            } }
                    });
                });

                mobileNavSectionLinks.forEach(link => {
                    link.addEventListener('click', function (event) {
                        event.preventDefault();
                        const filePath = this.dataset.src;
                        const originalLink = Array.from(desktopNavSectionLinks).find(dLink => dLink.dataset.src === filePath);
                        if (originalLink) {
                            loadAndDisplayContent(filePath, originalLink); // 하이라이트는 데스크탑 링크 기준
                        } else { // 이론상으론 발생 안함
                            loadAndDisplayContent(filePath, this); // fallback
                        }
                        toggleMobileSidebar(false); // 링크 클릭 후 모바일 사이드바 닫기
                    });
                });
            }


            // --- 뷰 모드에 따른 UI 처리 ---
            function handleViewChange() {
                isMobile = window.innerWidth <= 768;
                if (isMobile) {
                    hamburgerBtn.style.display = 'block';
                    pageNavButtonsContainer.style.display = 'flex'; // 모바일에서 이전/다음 버튼 보이기
                    // 데스크탑 네비게이션의 hover 비활성화는 CSS에서 처리
                } else {
                    hamburgerBtn.style.display = 'none';
                    mobileSidebarContainer.classList.remove('open'); // 모바일 사이드바 닫기
                    mobileOverlay.classList.remove('active');      // 오버레이 닫기
                    pageNavButtonsContainer.style.display = 'none'; // 데스크탑에서 이전/다음 버튼 숨기기
                    // 데스크탑 네비게이션 hover 활성화는 CSS에서 처리
                }
                updatePageNavigationButtons(); // 이전/다음 버튼 상태 업데이트
            }

            // --- 모바일 사이드바 토글 ---
            function toggleMobileSidebar(show) {
                if (show) {
                    mobileSidebarContainer.classList.add('open');
                    mobileOverlay.classList.add('active');
                } else {
                    mobileSidebarContainer.classList.remove('open');
                    mobileOverlay.classList.remove('active');
                }
            }

            hamburgerBtn.addEventListener('click', () => toggleMobileSidebar(true));
            mobileOverlay.addEventListener('click', () => toggleMobileSidebar(false));
            mobileSidebarCloseBtn.addEventListener('click', () => toggleMobileSidebar(false));


            // --- 데스크탑 네비게이션 아코디언 (기존 로직 그대로) ---
            desktopNavModuleTitles.forEach(titleWrapper => {
                titleWrapper.addEventListener('click', function () {
                    if (isMobile) return; // 모바일이면 데스크탑 아코디언 동작 안함

                    const isActive = this.classList.contains('active');
                    const sectionList = this.nextElementSibling;
                    if (!isActive) {
                        desktopNavModuleTitles.forEach(otherHeader => {
                            if (otherHeader !== this && otherHeader.classList.contains('active')) {
                                otherHeader.classList.remove('active');
                                const otherList = otherHeader.nextElementSibling;
                                if (otherList && otherList.classList.contains('nav-section-list')) {
                                    otherList.style.maxHeight = null; otherList.style.paddingTop = "0px"; otherList.style.paddingBottom = "0px";
                                } } }); }
                    this.classList.toggle('active');
                    if (sectionList && sectionList.classList.contains('nav-section-list')) {
                        if (this.classList.contains('active')) {
                            sectionList.style.paddingTop = sectionListPadding + "px"; sectionList.style.paddingBottom = sectionListPadding + "px";
                            sectionList.style.maxHeight = (sectionList.scrollHeight + sectionListPadding * 2) + "px";
                        } else {
                            sectionList.style.maxHeight = null; sectionList.style.paddingTop = "0px"; sectionList.style.paddingBottom = "0px";
                        } }
                });
            });

            // --- 데스크탑 네비게이션 링크 클릭 (기존 로직 그대로) ---
            desktopNavSectionLinks.forEach(link => {
                link.addEventListener('click', function (event) {
                    event.preventDefault();
                    if (isMobile) return; // 모바일이면 데스크탑 링크 직접 클릭은 무시 (햄버거 메뉴 사용 유도)
                    loadAndDisplayContent(this.dataset.src, this);
                });
            });


            // --- 콘텐츠 로드 및 표시 함수 (기존 로직 거의 그대로, linkElement는 항상 데스크탑 링크) ---
            async function loadAndDisplayContent(filePath, linkElementToHighlight) {
                if (currentActiveLinkElement) {
                    currentActiveLinkElement.parentElement.classList.remove('current-page');
                }
                linkElementToHighlight.parentElement.classList.add('current-page');
                currentActiveLinkElement = linkElementToHighlight; // 데스크탑 네비게이션의 링크

                const newHash = filePath.split('.')[0];
                if(window.location.hash !== `#${newHash}`) history.replaceState(null, null, `#${newHash}`);
                contentDisplay.classList.remove('loaded'); contentDisplay.style.opacity = '0';
                contentDisplay.innerHTML = '<p style="text-align:center; padding: 20px;">로딩 중...</p>';
                contentDisplay.dataset.loadedFile = filePath;
                if (currentModuleStyleLink) currentModuleStyleLink.remove(); currentModuleStyleLink = null;
                const moduleMatch = filePath.match(/module(\d+)_section(\w+)\.html/);
                if (moduleMatch && moduleMatch[1]) {
                    const moduleNumber = moduleMatch[1], sectionIdentifier = moduleMatch[2];
                    const moduleStyleHref = `css/module${moduleNumber}_section${sectionIdentifier}_styles.css`;
                    const newStyleLink = document.createElement('link');
                    newStyleLink.rel = 'stylesheet'; newStyleLink.type = 'text/css'; newStyleLink.href = moduleStyleHref;
                    newStyleLink.setAttribute('data-module-style', `module${moduleNumber}_section${sectionIdentifier}`);
                    document.head.appendChild(newStyleLink); currentModuleStyleLink = newStyleLink;
                }
                if (currentScrollListener) mainContentArea.removeEventListener('scroll', currentScrollListener); currentScrollListener = null;
                try {
                    const response = await fetch(filePath);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status} for ${filePath}`);
                    contentDisplay.innerHTML = await response.text();
                    const loadedSlideContainer = contentDisplay.querySelector('.slide-container');
                    if (loadedSlideContainer) {
                        currentScrollListener = initializeSlidesForCurrentPage(loadedSlideContainer, mainContentArea, filePath);
                        if (currentScrollListener) { mainContentArea.addEventListener('scroll', currentScrollListener); currentScrollListener(); }
                    }
                } catch (error) {
                    console.error('Error loading content:', error);
                    contentDisplay.innerHTML = `<div style="padding:20px; text-align:center; color:red;"><h2>오류 발생</h2><p>콘텐츠를 불러오는 중 문제가 발생했습니다.</p><p>${error.message}</p><p>파일 경로(${filePath})를 확인해주세요.</p></div>`;
                } finally {
                    setTimeout(() => { contentDisplay.style.opacity = '1'; contentDisplay.classList.add('loaded'); }, 50);
                    mainContentArea.scrollTop = 0;
                    updatePageNavigationButtons();
                }
            }

            // --- 슬라이드 초기화 함수 (기존 로직 그대로) ---
            function initializeSlidesForCurrentPage(container, scroller, filePath) { /* ... 이전 코드와 동일 ... */
                 const slides = container.querySelectorAll('.slide'); if (slides.length === 0) return null;
                const checkSlidesInView = function() {
                    slides.forEach(slide => {
                        const slideRect = slide.getBoundingClientRect(), scrollerRect = scroller.getBoundingClientRect();
                        const slideTopInScroller = slideRect.top - scrollerRect.top, scrollerHeight = scroller.clientHeight;
                        if (slideTopInScroller < scrollerHeight * 0.85 && (slideTopInScroller + slide.offsetHeight) > scrollerHeight * 0.15) {
                            slide.classList.add('active');
                        } }); }; return checkSlidesInView;
            }

            // --- URL 해시 변경 감지 및 초기 로드 함수 (기존 로직, 데스크탑 링크 기준) ---
            function activateParentModuleOfLink(linkElement) { // linkElement는 desktopNav의 링크여야 함
                const parentModuleTitleWrapper = linkElement.closest('.nav-module-group').querySelector('.nav-module-title-wrapper');
                const targetNavModuleTitles = isMobile ? mobileSidebarContainer.querySelectorAll('.nav-module-title-wrapper')
                                                     : desktopNavModuleTitles;
                const targetModuleTitleInScope = isMobile ?
                    Array.from(targetNavModuleTitles).find(mTitle => mTitle.dataset.moduleId === parentModuleTitleWrapper.dataset.moduleId)
                    : parentModuleTitleWrapper;


                if (targetModuleTitleInScope && !targetModuleTitleInScope.classList.contains('active')) {
                    targetNavModuleTitles.forEach(otherHeader => {
                        if (otherHeader !== targetModuleTitleInScope && otherHeader.classList.contains('active')) {
                            otherHeader.classList.remove('active');
                            const otherList = otherHeader.nextElementSibling;
                            if (otherList) { otherList.style.maxHeight = null; otherList.style.paddingTop = "0px"; otherList.style.paddingBottom = "0px"; }
                        }
                    });
                    targetModuleTitleInScope.classList.add('active');
                    const sectionListToOpen = targetModuleTitleInScope.nextElementSibling;
                    if (sectionListToOpen) {
                        sectionListToOpen.style.paddingTop = sectionListPadding + "px";
                        sectionListToOpen.style.paddingBottom = sectionListPadding + "px";
                        sectionListToOpen.style.maxHeight = (sectionListToOpen.scrollHeight + sectionListPadding * 2) + "px";
                    }
                }
            }

            function loadContentFromHash() {
                const hash = window.location.hash.substring(1);
                if (hash) {
                    const targetLink = Array.from(desktopNavSectionLinks).find(link => link.dataset.src.split('.')[0] === hash);
                    if (targetLink) {
                        loadAndDisplayContent(targetLink.dataset.src, targetLink);
                        activateParentModuleOfLink(targetLink);
                    } else { loadInitialContent(); }
                } else { loadInitialContent(); }
            }

            function loadInitialContent() {
                const firstValidLink = desktopNav.querySelector('.nav-section-item a[data-src]');
                if (firstValidLink) {
                    loadAndDisplayContent(firstValidLink.dataset.src, firstValidLink);
                    activateParentModuleOfLink(firstValidLink);
                } else {
                    contentDisplay.innerHTML = '<h1>환영합니다!</h1><p>왼쪽 메뉴에 마우스를 올리면 전체 목차가 나타납니다. 학습할 내용을 선택해주세요.</p>';
                    contentDisplay.classList.add('loaded');
                    updatePageNavigationButtons();
                }
            }

            // --- 이전/다음 버튼 로직 (데스크탑 링크 기준) ---
            function updatePageNavigationButtons() {
                if (!isMobile || !currentActiveLinkElement) { // currentActiveLinkElement는 데스크탑 nav의 링크
                    pageNavButtonsContainer.style.display = 'none'; return;
                }
                pageNavButtonsContainer.style.display = 'flex'; // 모바일이고 활성 링크 있으면 보임

                const allDesktopLinksArray = Array.from(desktopNavSectionLinks);
                const currentIndex = allDesktopLinksArray.findIndex(link => link === currentActiveLinkElement);

                prevSectionBtn.disabled = !(currentIndex > 0);
                prevSectionBtn.onclick = (currentIndex > 0) ? () => {
                    const prevLink = allDesktopLinksArray[currentIndex - 1];
                    loadAndDisplayContent(prevLink.dataset.src, prevLink);
                    activateParentModuleOfLink(prevLink);
                } : null;

                nextSectionBtn.disabled = !(currentIndex >= 0 && currentIndex < allDesktopLinksArray.length - 1);
                nextSectionBtn.onclick = (currentIndex >= 0 && currentIndex < allDesktopLinksArray.length - 1) ? () => {
                    const nextLink = allDesktopLinksArray[currentIndex + 1];
                    loadAndDisplayContent(nextLink.dataset.src, nextLink);
                    activateParentModuleOfLink(nextLink);
                } : null;
            }


            // --- 초기화 ---
            initializeMobileSidebar(); // 모바일 사이드바 설정
            handleViewChange();        // 초기 뷰(데스크탑/모바일) 설정
            window.addEventListener('resize', handleViewChange); // 화면 크기 변경 감지
            loadContentFromHash();     // URL 해시에 따른 초기 콘텐츠 로드
            window.addEventListener('hashchange', loadContentFromHash); // 해시 변경 감지

        });
    </script>
</body>
</html>
