<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI, 건설 업무의 시간을 되돌려 드립니다! - 커리큘럼</title>
    <link rel="stylesheet" href="css/common_styles.css">
    <!-- 모듈별 CSS는 JavaScript로 동적 로드 -->
</head>
<body>
    <nav class="page-navigation" id="pageNav">
        <div class="nav-header">커리큘럼</div>
        <div class="nav-scroll-wrapper">
            <ul class="nav-curriculum-list">
                <li class="nav-module-group">
                    <div class="nav-module-title-wrapper" data-module-id="module1">
                        <span class="nav-module-title">Module 1: 왜 AI인가? 반복 업무 해방의 시작</span>
                        <span class="nav-toggle-icon">></span>
                    </div>
                    <ul class="nav-section-list">
                        <li class="nav-section-item"><a href="#" data-src="module1_section1.html">1. 오프닝: AI로 당신의 업무 시간을 되찾으세요!</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module1_section2.html">2. 당신의 하루, 혹시 이렇지 않나요? (업무 Pain Points)</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module1_section3.html">3. AI: 당신의 똑똑한 업무 비서 (생성형 AI란?)</a></li>
                        <!-- <li class="nav-section-item"><a href="#" data-src="module1_section4.html">4. AI 특공대: 당신의 업무를 도와줄 AI 도구들</a></li> -->
                    </ul>
                </li>
                <li class="nav-module-group">
                    <div class="nav-module-title-wrapper" data-module-id="module2">
                        <span class="nav-module-title">Module 2: AI와 제대로 소통하기 (ft. 핵심 도구)</span>
                        <span class="nav-toggle-icon">></span>
                    </div>
                    <ul class="nav-section-list">
                        <li class="nav-section-item"><a href="#" data-src="module2_section1.html">1. AI의 능력을 100% 끌어내는 '프롬프트' 작성법</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module2_section2.html">2. AI 특공대, 직접 다뤄보기 (주요 도구 시연)</a></li>
                    </ul>
                </li>
                <li class="nav-module-group">
                    <div class="nav-module-title-wrapper" data-module-id="module3">
                        <span class="nav-module-title">Module 3: 실전! AI로 업무 효율 2배 UP! (시연 중심)</span>
                        <span class="nav-toggle-icon">></span>
                    </div>
                    <ul class="nav-section-list">
                         <li class="nav-section-item"><a href="#" data-src="module3_section1.html">1. 정보 검색 & 수집: AI로 10분 만에 끝내기!</a></li>
                         <li class="nav-section-item"><a href="#" data-src="module3_section2.html">2. 내 손안의 자료, AI로 지식 자산 만들기 (NotebookLM 활용)</a></li>
                         <li class="nav-section-item"><a href="#" data-src="module3_section3.html">3. 회의록 정리: AI로 5분 만에 핵심만 쏙!</a></li>
                         <li class="nav-section-item"><a href="#" data-src="module3_section4.html">4. 보고서·기획서 작성: AI로 시간 절반으로 줄이기!</a></li>
                    </ul>
                </li>
                <li class="nav-module-group">
                    <div class="nav-module-title-wrapper" data-module-id="module4">
                        <span class="nav-module-title">Module 4: AI, 안전하고 똑똑하게 활용하기</span>
                        <span class="nav-toggle-icon">></span>
                    </div>
                    <ul class="nav-section-list">
                        <li class="nav-section-item"><a href="#" data-src="module4_section1.html">1. AI, 안전하게 써야 진짜 전문가! (핵심 주의사항)</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module4_section2.html">2. (맛보기) AI로 내 업무 자동화하기 아이디어</a></li>
                        <li class="nav-section-item"><a href="#" data-src="module4_section3.html">3. 마무리: AI 시대, 당신의 업무는 어떻게 바뀔까요?</a></li>
                    </ul>
                </li>
            </ul>
            <!-- 메인 페이지로 돌아가기 버튼 추가 -->
            <div class="nav-mainpage-link-wrapper">
                <a href="index.html" class="nav-mainpage-link">메인 페이지</a>
            </div>
        </div>
    </nav>

    <main class="main-content-area" id="mainContent">
        <article id="contentDisplay">
            <h1>환영합니다!</h1>
            <p>왼쪽 메뉴에 마우스를 올리면 전체 목차가 나타납니다. 학습할 내용을 선택해주세요.</p>
        </article>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const navModuleTitles = document.querySelectorAll('.page-navigation .nav-module-title-wrapper');
            const navSectionLinks = document.querySelectorAll('.page-navigation .nav-section-item a');
            const contentDisplay = document.getElementById('contentDisplay');
            const sectionListPadding = 8; // 네비게이션 섹션 리스트 패딩 값
            let currentActiveLinkElement = null;
            let currentScrollListener = null; // 현재 페이지의 스크롤 리스너
            let currentModuleStyleLink = null; // 현재 로드된 모듈 CSS 링크를 추적

            // 네비게이션 모듈 아코디언 토글
            navModuleTitles.forEach(titleWrapper => {
                titleWrapper.addEventListener('click', function () {
                    const isActive = this.classList.contains('active');
                    const sectionList = this.nextElementSibling;

                    // 다른 열린 모듈 닫기
                    if (!isActive) {
                        navModuleTitles.forEach(otherHeader => {
                            if (otherHeader !== this && otherHeader.classList.contains('active')) {
                                otherHeader.classList.remove('active');
                                const otherList = otherHeader.nextElementSibling;
                                if (otherList && otherList.classList.contains('nav-section-list')) {
                                    otherList.style.maxHeight = null;
                                    otherList.style.paddingTop = "0px";
                                    otherList.style.paddingBottom = "0px";
                                }
                            }
                        });
                    }

                    this.classList.toggle('active');

                    if (sectionList && sectionList.classList.contains('nav-section-list')) {
                        if (this.classList.contains('active')) {
                            sectionList.style.paddingTop = sectionListPadding + "px";
                            sectionList.style.paddingBottom = sectionListPadding + "px";
                            sectionList.style.maxHeight = (sectionList.scrollHeight + sectionListPadding * 2) + "px";
                        } else {
                            sectionList.style.maxHeight = null;
                            sectionList.style.paddingTop = "0px";
                            sectionList.style.paddingBottom = "0px";
                        }
                    }
                });
            });

            // 콘텐츠 로드 및 표시 함수
            async function loadAndDisplayContent(filePath, linkElement) {
                // 현재 활성화된 링크 스타일 제거 및 새 링크에 스타일 적용
                if (currentActiveLinkElement) {
                    currentActiveLinkElement.parentElement.classList.remove('current-page');
                }
                linkElement.parentElement.classList.add('current-page');
                currentActiveLinkElement = linkElement;

                // URL 해시 업데이트 (페이지 새로고침 없이)
                const newHash = filePath.split('.')[0]; // 예: "module1_section1"
                if(window.location.hash !== `#${newHash}`) {
                    history.replaceState(null, null, `#${newHash}`);
                }

                // 로딩 중 표시 및 이전 콘텐츠 제거 준비
                contentDisplay.classList.remove('loaded'); // 로드 완료 클래스 제거 (애니메이션용)
                contentDisplay.style.opacity = '0'; // 부드러운 전환을 위해 투명도 조절
                contentDisplay.innerHTML = '<p style="text-align:center; padding: 20px;">로딩 중...</p>'; // 로딩 메시지
                contentDisplay.dataset.loadedFile = filePath; // 현재 로드된 파일명 저장

                // 동적으로 추가된 모듈별 CSS 제거
                if (currentModuleStyleLink) {
                    currentModuleStyleLink.remove();
                    currentModuleStyleLink = null;
                }

                // 파일 경로에서 모듈 번호 추출하여 해당 모듈 CSS 로드
                const moduleMatch = filePath.match(/module(\d+)_section(\w+)\.html/); // 정규식으로 모듈 및 섹션 번호 추출
                if (moduleMatch && moduleMatch[1]) {
                    const moduleNumber = moduleMatch[1];
                    const sectionIdentifier = moduleMatch[2]; // section1, section2_3 등
                    const moduleStyleHref = `css/module${moduleNumber}_section${sectionIdentifier}_styles.css`;

                    // 파일 존재 여부 확인 후 CSS 링크 추가 (선택 사항, 404 에러 방지)
                    // 이 부분은 실제 서버 환경에서 fetch로 확인하거나, 파일 목록을 미리 아는 경우 생략 가능
                    const newStyleLink = document.createElement('link');
                    newStyleLink.rel = 'stylesheet';
                    newStyleLink.type = 'text/css';
                    newStyleLink.href = moduleStyleHref;
                    newStyleLink.setAttribute('data-module-style', `module${moduleNumber}_section${sectionIdentifier}`);
                    document.head.appendChild(newStyleLink);
                    currentModuleStyleLink = newStyleLink;
                }


                const mainContentArea = document.getElementById('mainContent');
                // 이전 페이지의 스크롤 이벤트 리스너 제거
                if (currentScrollListener) {
                    mainContentArea.removeEventListener('scroll', currentScrollListener);
                    currentScrollListener = null;
                }

                try {
                    const response = await fetch(filePath);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status} for ${filePath}`);
                    }
                    const htmlContent = await response.text();
                    contentDisplay.innerHTML = htmlContent; // 새 콘텐츠 삽입

                    // 로드된 HTML 조각 내의 스크립트 실행 (만약 각 HTML 조각에 JS가 있다면)
                    // 현재는 각 HTML 조각의 JS는 해당 파일 내에서 DOMContentLoaded로 실행되도록 가정
                    // 또는, spa_page.js에서 공통으로 처리할 수도 있음 (initializeSlidesForCurrentPage 처럼)
                    const scriptsInContent = contentDisplay.querySelectorAll('script');
                    scriptsInContent.forEach(script => {
                        const newScript = document.createElement('script');
                        if (script.src) {
                            newScript.src = script.src;
                        } else {
                            newScript.textContent = script.textContent;
                        }
                        // document.body.appendChild(newScript).remove(); // 스크립트 실행 후 제거 (전역 스코프 문제 주의)
                        // script 태그를 직접 실행하는 것은 복잡하므로, 각 HTML 조각 내 JS가 스스로 실행되도록 하거나
                        // 여기서 특정 함수를 호출하는 방식으로 변경하는 것이 더 안전함.
                        // 현재는 각 HTML 파일 내의 JS가 DOMContentLoaded에 의해 실행된다고 가정하고,
                        // SPA에서는 해당 JS가 중복 실행되지 않도록 주의해야 함.
                        // 여기서는 공통 슬라이드 초기화 함수를 호출
                    });


                    // 로드된 콘텐츠에 슬라이드가 있다면 슬라이드 초기화 및 스크롤 리스너 설정
                    const loadedSlideContainer = contentDisplay.querySelector('.slide-container');
                    if (loadedSlideContainer) {
                        currentScrollListener = initializeSlidesForCurrentPage(loadedSlideContainer, mainContentArea, filePath);
                        if (currentScrollListener) {
                             mainContentArea.addEventListener('scroll', currentScrollListener);
                             currentScrollListener(); // 초기 뷰 체크
                        }
                    }

                } catch (error) {
                    console.error('Error loading content:', error);
                    contentDisplay.innerHTML = `<div style="padding:20px; text-align:center; color:red;"><h2>오류 발생</h2><p>콘텐츠를 불러오는 중 문제가 발생했습니다.</p><p>${error.message}</p><p>파일 경로(${filePath})를 확인해주세요. 로컬 웹 서버에서 실행 중인지도 확인해주세요.</p></div>`;
                } finally {
                    // 콘텐츠 로드 완료 후 애니메이션 효과
                    setTimeout(() => {
                        contentDisplay.style.opacity = '1';
                        contentDisplay.classList.add('loaded');
                    }, 50);
                    mainContentArea.scrollTop = 0; // 새 콘텐츠 로드 시 스크롤 맨 위로
                }
            }

            // 현재 페이지의 슬라이드 초기화 함수
            function initializeSlidesForCurrentPage(container, scroller, filePath) {
                const slides = container.querySelectorAll('.slide');
                if (slides.length === 0) return null;

                // 각 HTML 조각의 JS가 이미 슬라이드 번호와 초기 active를 설정했을 수 있으므로,
                // 여기서는 스크롤에 따른 'active' 클래스 제어만 담당하거나,
                // 또는 모든 초기화를 여기서 중앙 집중적으로 처리하도록 선택할 수 있음.
                // 여기서는 스크롤 이벤트 핸들러만 반환하여 추가.
                // 슬라이드 번호 및 초기 active는 각 HTML 파일의 JS에서 처리한다고 가정.

                const checkSlidesInView = function() { // 스크롤 시 슬라이드 활성화 함수
                    slides.forEach(slide => {
                        const slideRect = slide.getBoundingClientRect();
                        const scrollerRect = scroller.getBoundingClientRect();
                        const slideTopInScroller = slideRect.top - scrollerRect.top;
                        const scrollerHeight = scroller.clientHeight;

                        // 슬라이드가 뷰포트의 특정 영역에 들어오면 active 클래스 추가
                        if (slideTopInScroller < scrollerHeight * 0.85 && (slideTopInScroller + slide.offsetHeight) > scrollerHeight * 0.15) {
                            slide.classList.add('active');
                        } else {
                            // slide.classList.remove('active'); // 뷰포트 벗어나면 비활성화 (선택 사항)
                        }
                    });
                };
                return checkSlidesInView; // 스크롤 이벤트 핸들러 함수 반환
            }


            // 네비게이션 링크 클릭 이벤트
            navSectionLinks.forEach(link => {
                link.addEventListener('click', function (event) {
                    event.preventDefault();
                    loadAndDisplayContent(this.dataset.src, this);
                });
            });

            // URL 해시 변경 감지 및 초기 로드 함수
            function loadContentFromHash() {
                const hash = window.location.hash.substring(1); // # 제거
                if (hash) {
                    const targetLink = Array.from(navSectionLinks).find(link => {
                        const dataSrcFileName = link.dataset.src.split('.')[0]; // 파일 확장자 제거
                        return dataSrcFileName === hash;
                    });

                    if (targetLink) {
                        loadAndDisplayContent(targetLink.dataset.src, targetLink);
                        // 해당 모듈 아코디언 열기
                        const parentModuleTitleWrapper = targetLink.closest('.nav-module-group').querySelector('.nav-module-title-wrapper');
                        if (parentModuleTitleWrapper && !parentModuleTitleWrapper.classList.contains('active')) {
                            // 다른 열린 모듈 닫기
                            navModuleTitles.forEach(otherHeader => {
                                if (otherHeader !== parentModuleTitleWrapper && otherHeader.classList.contains('active')) {
                                    otherHeader.classList.remove('active');
                                    const otherList = otherHeader.nextElementSibling;
                                    if (otherList) { otherList.style.maxHeight = null; otherList.style.paddingTop = "0px"; otherList.style.paddingBottom = "0px"; }
                                }
                            });
                            // 현재 모듈 열기
                            parentModuleTitleWrapper.classList.add('active');
                            const sectionListToOpen = parentModuleTitleWrapper.nextElementSibling;
                            if (sectionListToOpen) {
                                sectionListToOpen.style.paddingTop = sectionListPadding + "px";
                                sectionListToOpen.style.paddingBottom = sectionListPadding + "px";
                                sectionListToOpen.style.maxHeight = (sectionListToOpen.scrollHeight + sectionListPadding * 2) + "px";
                            }
                        }
                    } else {
                        loadInitialContent(); // 해시에 해당하는 링크가 없으면 초기 콘텐츠 로드
                    }
                } else {
                    loadInitialContent(); // 해시가 없으면 초기 콘텐츠 로드
                }
            }

            // 초기 콘텐츠 로드 함수 (첫 번째 유효한 링크 또는 기본 메시지)
            function loadInitialContent() {
                const firstValidLink = document.querySelector('.page-navigation .nav-section-item a[data-src]');
                if (firstValidLink) {
                    loadAndDisplayContent(firstValidLink.dataset.src, firstValidLink);
                    // 첫 번째 모듈 아코디언 열기
                    const parentModuleTitleWrapper = firstValidLink.closest('.nav-module-group').querySelector('.nav-module-title-wrapper');
                    if (parentModuleTitleWrapper && !parentModuleTitleWrapper.classList.contains('active')) {
                        parentModuleTitleWrapper.classList.add('active');
                        const sectionListToOpen = parentModuleTitleWrapper.nextElementSibling;
                        if (sectionListToOpen) {
                            sectionListToOpen.style.paddingTop = sectionListPadding + "px";
                            sectionListToOpen.style.paddingBottom = sectionListPadding + "px";
                            sectionListToOpen.style.maxHeight = (sectionListToOpen.scrollHeight + sectionListPadding * 2) + "px";
                        }
                    }
                } else {
                    contentDisplay.innerHTML = '<h1>환영합니다!</h1><p>왼쪽 메뉴에 마우스를 올리면 전체 목차가 나타납니다. 학습할 내용을 선택해주세요.</p>';
                    contentDisplay.classList.add('loaded');
                }
            }

            // 페이지 로드 시 및 해시 변경 시 콘텐츠 로드
            loadContentFromHash();
            window.addEventListener('hashchange', loadContentFromHash);
        });
    </script>
</body>
</html>
